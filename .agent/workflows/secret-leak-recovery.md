---
description: 秘密情報（APIキー等）を誤ってGitにプッシュしてしまった際の緊急対応手順
---

# 秘密情報漏洩時の緊急対応ワークフロー

※Gitの操作以上に、情報の無効化が最優先です。

## フェーズ 1: 【即時】情報の無効化
履歴から消す前に、まずその情報の価値をゼロにします。

1. **キーの更新・失効**: 漏洩したAPIキー、パスワード、秘密鍵をシステム側ですぐに変更・削除します。
2. **ログの確認**: もし可能であれば、漏洩したキーが不正利用されていないか確認します。

## フェーズ 2: 【連携】チームへの通知
歴史を書き換えるため、全員の協力が必要です。

1. メンバーに状況を伝え、一度全ブランチへのプッシュを控えるよう依頼します。
2. 作業中の未プッシュコミットがある場合は、一度退避（stash）してもらうよう伝えます。

## フェーズ 3: 【技術】履歴の完全クリーニング
単なる `git rm` では過去の履歴に残るため、専用ツールを使用します。

### おすすめツール: git filter-repo
（Git公式が推奨している、Pythonベースの高速・安全なツールです）

```bash
# 特定のファイルを全履歴から完全に消去
git filter-repo --path path/to/secret_file --invert-paths
```

### 別の選択肢: BFG Repo-Cleaner
（Java製で、特定の文字列を置換するなどの操作に長けています）

```bash
# 全履歴から特定の文字列を「***REMOVED***」に置換
bfg --replace-text passwords.txt
```

## フェーズ 4: 強制プッシュと再同期
1. 管理者が `git push origin --force --all` ですべてのブランチを強制更新します。
2. **メンバー全員**が、自身のローカルリポジトリを最新の正しい歴史に同期させます。
   - 最も確実なのは、フォルダを一度削除して再クローンすることです。

## 予防策
- **pre-commit hook**: `git-secrets` や `leaktk` を導入し、プッシュ前に秘密情報が含まれていないか自動チェックする。
- **環境変数の徹底**: 秘密情報は必ず `.env` ファイルに書き、プロジェクト作成時点から `.gitignore` に含めておく。
